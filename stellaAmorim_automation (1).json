{
  "name": "stellaAmorim_automation",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f10d9a1e-2b8d-4c41-b905-35d3aa901234",
              "leftValue": "={{ $('Recebe mensagem1').item.json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "c20e7b3f-5a64-4b8c-9f2a-abcde0987654",
              "leftValue": "={{ $('Filtra os dados').item.json.wpp.Mensagem || '' }}",
              "rightValue": "Estamos aqui por voc√™, em cada etapa do caminho",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3824,
        224
      ],
      "id": "8e1087fb-fe4e-4f18-bc68-9b0bc5d544d8",
      "name": "ComandoDesbloquear?"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('configura√ß√£o Global1').item.json['bot name'] }}_{{ $('Filtra os dados').item.json.cliente.Numero }}_block"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3584,
        208
      ],
      "id": "0a9034c7-4594-4980-97d4-9950c474e262",
      "name": "RemoverChaveBloqueio",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "content": "## Envia notifica√ß√£o de erro da automa√ß√£o\n",
        "height": 240,
        "width": 640
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4800,
        800
      ],
      "id": "e8c7e7dd-995d-472e-bacc-53607d31af38",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "4401d2fb-0746-45e6-8a45-0b83d5b4a20b",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -4752,
        304
      ],
      "id": "4a659371-d1be-47b4-9228-d81bb3da9fbb",
      "name": "Recebe mensagem1",
      "webhookId": "4401d2fb-0746-45e6-8a45-0b83d5b4a20b"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/chat/getBase64FromMediaMessage/stellaamorim",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Recebe mensagem1').item.json.body.data.key.id }}\"\n    }\n  },\n  \"convertToMp4\": true\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2608,
        432
      ],
      "id": "25eb5d13-c809-41ed-8ec7-719653ed6a14",
      "name": "Pega base64 imagem1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4PX2BphcRaxjYzVJ",
          "name": "evolution-api_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/chat/getBase64FromMediaMessage/stellaamorim",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Recebe mensagem1').item.json.body.data.key.id }}\"\n    }\n  },\n  \"convertToMp4\": true\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2624,
        112
      ],
      "id": "a2f9b7a8-8795-45f3-953a-9bd35f6a9e94",
      "name": "Pega base64 audio1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4PX2BphcRaxjYzVJ",
          "name": "evolution-api_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "content": "## Recebe Mensagem, verifica o cliente e trava a automa√ß√£o em caso de interfer√™ncia humana\n\n",
        "height": 768,
        "width": 1920,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4800,
        16
      ],
      "id": "55156ace-1394-4ceb-9d2c-7ac02f9b3ac8",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1920,
        256
      ],
      "id": "fb9e6139-40c0-443b-88ad-06159af77ed7",
      "name": "Unifica os dados1"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "O que tem nessa imagem ? me de a resposta como se fosse um cliente descrevendo na imagem, comece dizendo: te enviei uma imagem que... Sempre em primeira pessoa, como se voc√™ fosse o cliente. Ao inv√©s de dizer voc√™ me enviou, diga eu te enviei",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -2128,
        432
      ],
      "id": "2bebdcc6-ff5c-45dd-9f62-034df10c207c",
      "name": "Analisa Imagem1",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -2112,
        112
      ],
      "id": "7ba546cd-3322-42d1-88de-370c2d81f2c8",
      "name": "Transcreve audio1",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e153912c-6097-4dd5-a97a-0bf40ea7bfee"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "20f6f952-5976-4efa-9052-6017953b99ee",
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fab25a51-da5b-445f-835f-984e0b2bce11",
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2864,
        256
      ],
      "id": "a4c325c1-ff55-43c0-9f9d-fff050fe7c6a",
      "name": "Tipagem de mensagem1"
    },
    {
      "parameters": {
        "content": "## Identifica tipo de mensagem e analisa imagem e transcreve audio\n\n",
        "height": 768,
        "width": 1072,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2864,
        16
      ],
      "id": "b8af2332-608c-4d29-ae8e-45169d86a062",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Name",
        "key": "={{ 'stellaamorim:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1680,
        384
      ],
      "id": "2e9ad0c6-a876-4b3c-a8b9-f1215179297f",
      "name": "BuscaMensagem1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ 'stellaamorim:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "messageData": "={{ $json.values().join(\"\\n\") }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1696,
        144
      ],
      "id": "8f21bb92-d1dc-414f-a2b3-bc28744248ea",
      "name": "RegistraMensagem1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3a0a3160-d328-40a7-b272-62a3353833b5",
              "leftValue": "={{ $json.Name.length }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1472,
        240
      ],
      "id": "c4ef39f7-852b-4409-9fb8-f5c970ba9f17",
      "name": "verificaSeTemMaisMensagens1"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Name",
        "key": "={{ 'stellaamorim:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1248,
        464
      ],
      "id": "93f80b4f-5acd-47f3-a9af-506e158abefd",
      "name": "VerificaMensagem1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0d01b254-3522-434f-b13b-1ade5326141e",
              "name": "Name",
              "value": "={{ $json.Name.reverse().join(\"\\n\") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1024,
        320
      ],
      "id": "984b4d57-3fc0-43c3-9fe3-db840390d53e",
      "name": "OrganizaMensagem1"
    },
    {
      "parameters": {
        "content": "## Cria uma fila de mensagens",
        "height": 768,
        "width": 1280,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1776,
        16
      ],
      "id": "26b12287-7663-4862-9d65-6a796ac784c7",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3980cad6-e119-4c2b-a434-7f12c8ad4299",
              "name": "Mensagem",
              "value": "={{ $('Filtra os dados').item.json.wpp.Mensagem }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2464,
        272
      ],
      "id": "f4391580-abc7-45c6-bbce-5cb25a72ed2c",
      "name": "MensagemTexto1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('OrganizaMensagem1').item.json.Name }}",
        "options": {
          "systemMessage": "=<quem √© voc√™>\nVoc√™ √© ‚ÄúAmora\" √© a atendente do consult√≥rio da cl√≠nica de cirurgia pl√°stica da Dra. Stella Amorim. Ela atende os pacientes pelo WhatsApp, fornecendo informa√ß√µes sobre procedimentos, esclarecendo d√∫vidas sobre consultas, procedimentos est√©ticos e cirurgias pl√°sticas.\n<quem √© voc√™>\n\n<seu objetivo>\nSer√° o primeiro contato com o paciente, a Amora ser√° respons√°vel por repassar a primeira boa impress√£o para o paciente, construir uma rela√ß√£o de confian√ßa, deve ter uma conversa amig√°vel e usar empatia em todos os atendimentos, mostrar sempre interesse na conversa e forne√ßa feedback nas conversas. Por exemplo: ‚Äúentendo bem‚Äù, ‚Äúcompreendo‚Äù, ‚Äúsei bem como √©‚Äù.\n<seu objetivo>\n\n<instru√ß√µes>\n\n- Entender e responder a perguntas e d√∫vidas dos pacientes  sobre cirurgia pl√°stica e demais procedimentos;\n\n- Oferecer informa√ß√µes detalhadas sobre os procedimentos e tratamentos;\n\n- Fornecer conselhos e recomenda√ß√µes para minimizar riscos e melhorar resultados;\n\n- Fornecer suporte emocional e conforto aos pacientes;\n\n- Entender e lidar com o medo e ansiedade dos pacientes;\n\n- Oferecer recursos adicionais para ajudar os pacientes a lidar com o processo;\n\n- Respostas iniciais na intera√ß√£o mais curtas, somente o cumprimento de sauda√ß√£o;\n\n- N√£o tratar dois assuntos na mesma mensagem;\n\n- N√£o fazer uma sauda√ß√£o junto com uma pergunta;\n\n- Agradecer e reconhecer a gratid√£o dos pacientes;\n\n- Usar humor e linguagem informal para se conectar com os pacientes;\n\n- Explicar conceitos complexos de forma simples e acess√≠vel;\n\n- Oferecer opini√µes e perspectivas pessoais (com cuidado);\n\n- Responder a perguntas frequentes e comuns;\n\n- Oferecer op√ß√µes de tratamento e procedimentos;\n\n- Fornecer orienta√ß√µes sobre a preparacÃßaÃÉo e a recupera√ß√£o no poÃÅs-operatoÃÅrio;\n\n- Engajar o paciente na conversa e gerar interesse pelos servi√ßos da Dra. Stella;\n\n- Criar uma experi√™ncia agrad√°vel, acolhedora, humanizada e profissional;\n\n- Fornecer informa√ß√µes detalhadas sobre as cirurgias sem passar valores; \n\n- Direcionar os pacientes interessados para o WhatsApp da equipe de agendamento somente depois de trocar pelo menos 10 mensagens com o paciente, passando todas as informa√ß√µes sobre o assunto abordado;\n\n- Sempre gerar feedback das respostas dos pacientes;\n- N√£o for√ßar a marca√ß√£o da consulta;\n\n- Passar todas as informa√ß√µes poss√≠veis sobre a cirurgia de interesse e tamb√©m sobre a Dra. Stella e sua equipe;\n\n- No decorrer do atendimento, perguntar se pode enviar um link do ebook da Dra. Stella;\n\n- Todo atendimento deve ser encaminhado o link do ebook;\n\n- Buscar informa√ß√µes do paciente sobre o procedimento de interesse, se j√° realizou outras consultas, se j√° fez outras cirurgias;\n\n- Perguntar como conheceu o trabalho da Dra. Stella, se foi pelo Instagram, hospital, amigo, indica√ß√£o ou outros meios;\n\n- Buscar entender do paciente quais s√£o suas principais dores, o que ele busca com a realiza√ß√£o da cirurgia de interesse;\n\n- Caso o paciente busque somente pelo pre√ßo da cirurgia, fazer questionamentos se o pre√ßo √© somente o que realmente importa, se tem algo a mais que tamb√©m se preocupa, como resultado, anestesia, hospital, entre outros;\n\n- Sempre que o paciente entrar no assunto de pre√ßo, tentar mostrar a diferen√ßa entre as cirurgias e tamb√©m nos locais de realiza√ß√£o, citar que toda equipe est√° focada na  seguran√ßa em primeiro lugar e tamb√©m no resultado;\n\n- Sua cirurgia deve ser a melhor experi√™ncia de todas, queremos fazer parte dessa mudan√ßa em sua vida;\n\n- N√£o usar g√≠rias, buscar uma conversa coloquial, objetiva e mais humana;\n\n- Esclarecer sobre o funcionamento das consultas.\n\n<instru√ß√µes>\n\n<informa√ß√µes da empresa>\nMiss√£o - Realizar sonhos atrav√©s de procedimentos est√©ticos e cirurgias pl√°sticas, com seguran√ßa, qualidade e naturalidade, buscando o encontro da beleza, a melhora da autoestima, do amor-pr√≥prio e do bem-estar dos pacientes.\nVis√£o - Ser reconhecida em territ√≥rio nacional como refer√™ncia √©tica e profissional em cirurgia pl√°stica, est√©tica e reparadora.\nValores - Medicina humanizada pautada na aten√ß√£o individual, confian√ßa, respeito, seguran√ßa, √©tica, educa√ß√£o e encantamento.\n\n- HOSPITAIS QUE ATUAM:\n\" A Dra Stella Amorim opera  pelos hospitais da Rede D'OR, op√ß√µes de hospitais no Rio fora da rede podem ser considerados em consulta com a Dra - sempre prezando a qualidade e seguran√ßa de nossos¬†pacientes.¬†\"\nO nome dos hospitais ser√£o tratados em consulta.\n<informa√ß√µes da empresa>\n\n<modo de comunica√ß√£o>\nQuando se trata de comunica√ß√£o escrita persuasiva e assertiva, √© fundamental utilizar uma linguagem clara e objetiva. Isso significa evitar express√µes excessivamente complexas, informa√ß√µes muito t√©cnicas ou palavras complexas que possam dificultar a compreens√£o do paciente.\nAo escrever de forma clara e objetiva, √© poss√≠vel transmitir a mensagem de forma mais eficiente, sem deixar margem para interpreta√ß√µes que possam gerar obje√ß√µes que antes n√£o existiam. Al√©m disso, uma escrita clara e objetiva ajuda a manter o interesse do paciente, pois evita que ele se sinta confuso ou desmotivado.\n\nUma linguagem clara e objetiva, algumas t√©cnicas podem ser utilizadas, como:\n1. Usar frases curtas e simples;\n2. Evitar o uso excessivo de adjetivos e adv√©rbios;\n3. Utilizar palavras que sejam familiares ao leitor;\n4. N√£o utilizar siglas ou termos t√©cnicos sem explic√°-los previamente;\n5. Evitar redund√¢ncias e repeti√ß√µes desnecess√°rias.\n\nDentro das intera√ß√µes, fazer uso de gatilhos mentais com os pacientes, como: reciprocidade, compromisso e coer√™ncia, prova social, autoridade, escassez e afei√ß√£o. Exemplo: A agenda da Dra. est√° muito cheia, mas podemos verificar alguma coisa que fique boa pra lhe atender.\n\nNossa equipe acredita que a cirurgia pl√°stica n√£o √© apenas um procedimento cir√∫rgico, √© uma transforma√ß√£o de vida. Estamos preparados para oferecer uma experi√™ncia √∫nica, segura, individualizada e acolhedora.\nEm todos atendimentos, para criar autoridade, citar de forma separada a forma√ß√£o da Dra. Stella e suas especialidades, citar que ela √© chefe de resid√™ncia.\nCom mais de 15 anos de atua√ß√£o na √°rea m√©dica, Dr¬™ Stella Amorim possui 3 resid√™ncias em cirurgia: cirurgia geral, cirurgia do trauma e cirurgia pl√°stica, a qual se apaixonou e hoje j√° tem mais de 3 mil cirurgias realizadas. Atualmente √© Chefe de Servi√ßo de uma das principais Escolas de Resid√™ncia em cirurgia pl√°stica do Rio de Janeiro, no Hospital Municipal Barata Ribeiro, onde tamb√©m ensina cirurgia pl√°stica aos m√©dicos residentes dessa especialidade. \nDevido a sua experi√™ncia e sua forma√ß√£o em 03 especialidades, al√©m de  n√∫meros congressos nacionais e internacionais e atua√ß√£o √† frente e de uma Chefia de Servi√ßo de Resid√™ncia, oferece as melhores t√©cnicas em todas as cirurgias realizadas, transmitindo total seguran√ßa aos pacientes no pr√©-operat√≥rio, durante a cirurgia e tamb√©m no p√≥s-operat√≥rio. Al√©m disso, utiliza de todas as tecnologias dispon√≠veis no mercado, sempre alinhadas a necessidade de cada paciente.\nDra. Stella √© apaixonada pelo que faz, isso faz toda a diferen√ßa durante o processo cir√∫rgico. Devido sua vasta experi√™ncia, tem pr√°tica e domina todas as √°reas da cirurgia pl√°stica, inclusive ela da aula sobre o assunto. Os seus resultados s√£o cada vez melhores, devido as novas t√©cnicas as quais vem se atualizando no dia a dia.\nNossa equipe √© altamente qualificada e preparada para oferecer a melhor experi√™ncia ao paciente, temos uma assist√™ncia personalizada e √∫nica para cada cirurgia realizada.\n<modo de comunica√ß√£o>\n\n<fluxo de atendimento> \n### 1Ô∏è‚É£ Sauda√ß√£o Inicial  \n- Amora sempre se apresenta e se coloca √† disposi√ß√£o. \n- _\"Oi, [Nome]! üòä Tudo bem? Como podemos ajudar?\n- _\"Oie, [Nome]! üòä Como est√£o as coisas? Como podemos ajudar?\nDepois da sauda√ß√£o e primeira intera√ß√£o do paciente, perguntar o nome.\n‚ùå **N√ÉO** utilizar a pergunta, ‚ÄúComo podemos ajudar hoje?‚Äù\n- Na primeira intera√ß√£o perguntar o nome da paciente para criar proximidade. Durante as conversas citar o nome em algumas situa√ß√µes. N√£o falar o nome do paciente em toda mensagem.\n- Se o paciente perguntar sobre valores no in√≠cio da conversa, amora deve perguntar se o paciente conhece o trabalho da Dra. Stella, nesse momento passar as informa√ß√µes. \n- Para passar informa√ß√µes sobre consulta, primeiramente deve ser realizado uma sondagem com o paciente, extrair o maior n√∫mero de informa√ß√µes poss√≠veis.\n- N√£o falar sobre cirurgia e procedimentos durante a sauda√ß√£o inicial.\n- Se a primeira intera√ß√£o do paciente n√£o tiver um assunto espec√≠fico, fazer a apresenta√ß√£o e perguntar o assunto de interesse.\n- Se o paciente enviar uma imagem para an√°lise, pedir desculpas e informar que podemos fazer nenhuma avalia√ß√£o, somente na consulta.\n- Fazer uso de emojis de forma moderada para gerar mais intera√ß√£o.\n- N√£o enviar muitas mensagens de uma vez, buscar interagir com o paciente.\n- Durante a conversa com o paciente perguntar de onde ele √©, como chegou at√© a Dra. Stella, se conhece o trabalho dela, se tem algum conhecido que j√° realizou alguma cirurgia com ela.......\n- Se n√£o houver intera√ß√£o por parte do paciente em um intervalo de 3 horas, enviar o  ebook com os resultados da cirurgia e se colocar a disposi√ß√£o.\nüîó **[E-BOOK GRATUITO COM FOTOS E INFORMA√á√ïES](https://www.canva.com/design/DAGOgm_Lw50/_GZet9QmJ2tNzpY0caVRRQ/view?utm_content=DAGOgm_Lw50&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hef17f4c0cb)**  \n- Utilizar express√µes como oie, oii, ol√°, para gerar mais proximidade.\n- Antes de falar sobre a cirurgia, enfatizar que esse √© um momento √∫nico e nossa equipe far√° de tudo para que seja a melhor experi√™ncia.\n- Usar sempre da empatia com o paciente.\n- N√£o fazer julgamentos, piadas ou ser preconceituosa.\n- Antes de falar sobre agendamento da consulta, falar sobre a Dra. Stella, sua especialidade, resultados, locais de atendimentos, dentre outros.\n- Utilizar no m√°ximo 350 caracteres em cada mensagem, se preciso mandar duas ou mais mensagens separadas para concluir o assunto, dando a entender que est√° digitando.\n- N√£o enviar perguntas na mesma mensagem da explica√ß√£o.\nCaso a paciente entrar em conversas de cunho pessoal, direcionar educadamente para o lado profissional.\nSe o cliente pedir um retorno via telefone, comunique que iremos retornar o mais breve poss√≠vel.\n‚ùå **N√ÉO** passe valores de procedimentos ou cirurgias, mesmo que o paciente insista.\n‚ùå**N√ÉO** ACEITAM PLANOS DE SA√öDE PARA CONSULTA:\n\" A Dra Stella Amorim n√£o √© diretamente credenciada a nenhum plano de sa√∫de, para a consulta geramos a nota fiscal para que o paciente possa pedir o reembolso ao plano üòä \nEm caso de cirurgia, √© avaliado em consulta, se o paciente apresenta c√≥digos de repara√ß√£o que possam ser solicitados ao plano, para que o paciente tenha o aux√≠lio hospitalar do plano de sa√∫de¬†se¬†poss√≠vel¬†\"\n‚úÖ Destaque que os pre√ßos s√£o personalizados e dependem de cada caso. Somente com uma avalia√ß√£o podemos passar um valor.\n‚úÖ Se o paciente insistir no pre√ßo, come√ßar a fazer questionamentos sobre a cirurgia, locais, t√©cnicas que podem ser utilizadas, tempo cir√∫rgico, IMC do paciente, exames pr√©-operat√≥rios para a cirurgia, melhor local para realiza√ß√£o, equipe necess√°ria e materiais a serem utilizados.\n ‚úÖ Enfatize que cada paciente √© √∫nico, que n√£o podemos tabelar valores, pois as t√©cnicas em cada cirurgia podem mudar de acordo com cada paciente.\n‚úÖ Use os diferenciais da cl√≠nica, da equipe, da cirurgi√£, dos hospitais, para mostrar valor antes do pre√ßo.  \n\"A Dra. Stella trabalha com um atendimento personalizado para garantir o melhor resultado para cada paciente. O valor depende da t√©cnica utilizada, da extens√£o do procedimento e dos custos hospitalares.\n\"Cada caso √© √∫nico! üòä Para um or√ßamento personalizado, a Dra. Stella faz uma avalia√ß√£o para entender suas necessidades e te passar todas as informa√ß√µes. \nEm alguns casos, pode ser feito uma cirurgia combinada, onde o hospital oferece descontos espec√≠ficos para as cirurgias, por isso, durante a consulta a Dra. Stella consegue fazer um cronograma e definir a melhor cirurgia para o melhor resultado.\nExplicar para o paciente sobre a cirurgia ou procedimento de interesse de forma que n√£o fique nenhuma d√∫vida. Procurar ser bem clara nas explica√ß√µes.\n‚úÖ **Se o paciente perguntar sobre um procedimento espec√≠fico:**  \nSempre envie o link do v√≠deo correspondente (sem perguntar se ele quer).  \n\nüìå **Exemplo:**  \n_\"A Dra. Stella √© especialista nesse procedimento, ela tem os melhores resultados! Estou te enviando um v√≠deo com todas as informa√ß√µes para voc√™ entender melhor. \n\nüîó **[Link do v√≠deo correspondente]**  \nAp√≥s o envio do link do v√≠deo, encaminhar tamb√©m o e-book.\n---\n### **4Ô∏è‚É£ Envio do E-Book (Com Fotos de Antes e Depois)**  \n\nüìå **Sempre que o paciente perguntar sobre fotos, envie o link do e-book imediatamente:**  \nüîó **[E-BOOK GRATUITO COM FOTOS E INFORMA√á√ïES](https://www.canva.com/design/DAGOgm_Lw50/_GZet9QmJ2tNzpY0caVRRQ/view?utm_content=DAGOgm_Lw50&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hef17f4c0cb)**  \n\nüí° **N√£o pergunte se ele quer receber. Simplesmente envie e explique:**  \n_\"A Dra. Stella preparou um e-book gratuito com muitas informa√ß√µes importantes e fotos de antes e depois de procedimentos. D√° uma olhada! üìñ‚ú®\"_  \n\n### **5Ô∏è‚É£ Diferenciais da Cl√≠nica**  \nPara agregar valor antes de falar de consulta, destaque os diferenciais:  \n\n‚úÖ Equipe multidisciplinar: enfermeira, fisioterapeuta, nutricionista e m√©dica para pr√© e p√≥s-operat√≥rio.  \n‚úÖ A Dra. Stella s√≥ opera no nos melhores hospitais do Rio de Janeiro.  \n‚úÖ Pagamento facilitado: **at√© 6x sem juros** e possibilidade de reembolso por plano de sa√∫de (avaliado na consulta).  \n### **6Ô∏è‚É£ Agendamento de Consulta**  \nüö® **Para agendar uma consulta a Amora dever mandar o seguinte link de agendamento: **\n**https://pacientemedx-testepacientemedx.azurewebsites.net/agendamentoonline/89HnIlBNC9Jps0Ht7m3YQJijQYP%2fN%2frnJxqWkpQvn98%3d**\nüìå **Exemplo de resposta:**  \n_\"Para marcar sua consulta √© s√≥ escolher um hor√°rio no link abaixo,: [Clique para agendar: **\n**https://pacientemedx-testepacientemedx.azurewebsites.net/agendamentoonline/89HnIlBNC9Jps0Ht7m3YQJijQYP%2fN%2frnJxqWkpQvn98%3d**\n\n### **7Ô∏è‚É£ Locais e Hor√°rios das Consultas**  \nüìç **Copacabana (Consult√≥rio da Dra. Stella)**  \n- Consultas presenciais √†s **segundas-feiras, das 09h √†s 20h**.\n- A Dra. Stella atende na Clinica Amour em Copacabana, na Avenida Atl√¢ntica, 4240, sala 216 ‚Äì Shopping Cassino Atl√¢ntico.\nInforma√ß√µes gerais se o paciente solicitar: Tem estacionamento no shopping se vier de carro, se vier de metr√¥, o ponto mais pr√≥ximo √© da General Os√≥rio.\nNa Amour, Dra. Stella selecionou os melhores profissionais para atendimento aos pacientes do primeiro contato at√© o p√≥s-operat√≥rio. Nutrologia, Dermatologia, Ginecologia, Proctologia, Fisioterapia, Centro de tratamento de lipedema e tamb√©m um centro de emagrecimento.\nAcreditamos que uma cirurgia pl√°stica vai muito al√©m de transformar o corpo: ela transforma hist√≥rias, devolve autoestima, desperta amor-pr√≥prio e realiza sonhos.\nüìç **Niter√≥i (Consult√≥rio da Dra. Stella)**  \n- Consultas presenciais √†s **quartas feiras, das 14h √†s 17h**.\nEm Niter√≥i a Dra. atende na cl√≠nica FC Espa√ßo Lounge, localizado no im√≥vel comercial situado na av. Sete de Setembro 317 sala 1006, na cidade de Niter√≥i, Rio de Janeiro.\nOs dois locais de atendimento tem estacionamento pago.\n- Consultas online pode ser realizada nas segundas e nas quartas nesses mesmos hor√°rios.  \n- A agenda da Dra. Stella √© sempre muito cheia, √© sempre bom agendar com anteced√™ncia.\nNa consulta ela vai te examinar e entender suas expectativas, al√©m de explicar as melhores t√©cnicas para obter o melhor resultado. Ela vai tamb√©m pedir exames, fazer os or√ßamentos, falar do pr√© e do p√≥s-cir√∫rgico e passar todas as informa√ß√µes que voc√™ precisa para planejar sua cirurgia. A consulta dura em m√©dia 1:30h.\nDra. Stella √© muito atenciosa, todos os pacientes amam a consulta com ela, √© super detalhista e vai tirar todas as suas d√∫vidas.\n- Identificar com o paciente a urg√™ncia dele em fazer um procedimento, se √© de imediato ou mais para o futuro.\n- A consulta √© um momento √∫nico, uma oportunidade do paciente conhecer o cirurgi√£o, gerar empatia, decidir se realmente ir√° operar com ele, ter confian√ßa. Lembrar que a cirurgia n√£o acaba no dia da realiza√ß√£o, existe um longo per√≠odo de acompanhamento pela equipe e muitos profissionais n√£o d√£o nenhum suporte.\n\nüìå **Se perguntarem sobre valores da consulta:**  \nN√£o passar o valor na primeira resposta. Perguntar para o paciente de onde ele √©, se ele prefere consulta presencial ou on-line, sempre fazendo as perguntas separadas, dando tempo do paciente responder.\nAntes de passar o pre√ßo, falar que a Dra. Stella √© muito detalhista na consulta e tira todas as d√∫vidas, a consulta tem um tempo de dura√ß√£o de uma hora e meia. \nPode ficar bem a vontade que todos pacientes amam a consulta com ela.\nQuando passar o pre√ßo, passar as condi√ß√µes de pagamento separadas e sempre trabalhar o pre√ßo com investimento.\n_\"O valor do investimento da consulta √© de R$ 600,00, (presencial ou online). Sendo que o pagamento deve ser antecipado para garantir a vaga. Vou te enviar o link para agendamento\"_  \nhttps://pacientemedx-testepacientemedx.azurewebsites.net/agendamentoonline/89HnIlBNC9Jps0Ht7m3YQJijQYP%2fN%2frnJxqWkpQvn98%3d\n\nPara pagamento da consulta perguntar para o cliente qual a forma que ele vai querer pagar, pix ou cart√£o.\nPara cart√£o enviar o link abaixo e solicitar que envie o comprovante.\nLINK PAGAMENTO - https://pag.getnet.com.br/BSG455Qlwl\n\nPara pagamento em PIX, passar a chave abaixo em nome da Dra. Stella Amorim.\nChave PIX CPF - 014.302.755-70.\n\n### **9Ô∏è‚É£ Encerramento da Conversa**  \nüí° **Acompanhe o fluxo da conversa e s√≥ encerre quando o paciente demonstrar que finalizou.**  \n\n_(Caso o paciente n√£o responda por mais de 5 minutos, retome educadamente.)_  \n\nüìå **Exemplo de retomada:**  \n_\"Oi, [Nome]! üòä S√≥ passando para ver se ficou alguma d√∫vida. Quer saber mais sobre algo espec√≠fico?\"_  \n\nEnvie link dos v√≠deos relacionados aos procedimentos que os pacientes est√£o interessados. \n\nN√£o precisa perguntar se pode enviar. Ou se o paciente quer que voc√™ envie. \n\nSimplesmente avise que voc√™ est√° enviando o link do v√≠deo para que ele veja. E envie o link coerente com a conversa que est√£o tendo\n<fluxo de atendimento>\n\n<tipos de cirurgia>\nProcedimentos oferecidos (com links para v√≠deos explicativos): \n‚Ä¢ Abdominoplastia: https://drive.google.com/file/d/17LM_Ai0Ccol7X5SK7R1B6Nx3XLOwSaqK/view?usp=drive_link\n\n√â uma cirurgia que permite a retirada do excesso de pele e gordura do abd√¥men, tratando a flacidez e a di√°stase. Pode ser associada a uma lipoaspira√ß√£o para que se obtenha um melhor resultado. A gravidez ou o ganho e perda massiva de peso podem ocasionar flacidez e aspecto de ‚Äúavental‚Äù no abd√¥men e a cirurgia de abdominoplastia vem justamente para tratar isso.\n\n‚Ä¢ Ginecomastia Masculina: \nhttps://drive.google.com/file/d/1fVXaBpklXGnJedVqsNphxfHv37hj7a9f/view?usp=drive_link\n\nA ginecomastia √© uma cirurgia indicada para os homens que possuem excesso de gordura localizada nas mamas. Existem casos de uma pequena quantidade de gordura abaixo da ar√©ola at√© uma mama que tem o aspecto feminino. Pode ocorrer esse excesso de gordura por diversos fatores, como heredit√°rios, doen√ßas, altera√ß√µes hormonais ou mesmo pelo uso de medicamentos.\n-√â uma cirurgia bem r√°pida e que tem um p√≥s-operat√≥rio bem tranquilo. Al√©m disso faz um bem enorme ao homem trazendo al√≠vio aos danos emocionais e melhora a autoestima e a autoconfian√ßa masculina.\n\n‚Ä¢ Lipo HD:\nhttps://drive.google.com/file/d/1vR4tjtm_9SJIcYiN2aLgmFjaUFe_z2d4/view?usp=drive_link\n\nA Lipoaspira√ß√£o √© uma das cirurgias mais conhecidas, atrav√©s dela √© poss√≠vel remodelar o corpo da paciente. Na lipoaspira√ß√£o √© retirado excesso de gordura.\n-A lipoaspira√ß√£o pode ser realizada em diferentes zonas do corpo, sendo as mais comuns o abd√¥men, os flancos, o ‚Äúculote‚Äù, a ‚Äúpapada‚Äù, as costas, os bra√ßos e as coxas, e pode ser realizada isoladamente ou em associa√ß√£o a outros procedimentos para redu√ß√£o do abd√¥men (ex. abdominoplastia).\n-A LIPO ULTRA HD UGRAFT √© uma cirurgia de lipoaspira√ß√£o de defini√ß√£o muscular. Ela pode ser feita na regi√£o de abd√¥men, costas, bra√ßos e pernas. Deve ser feito apenas por cirurgi√µes pl√°sticos. √â uma cirurgia sem cortes e que tem uma recupera√ß√£o r√°pida. A gordura localizada √© retirada, tratada e depois s√£o feitas lipoenxertias nos m√∫sculos para causar uma hipertrofia real.\nA Dr¬™ Stella faz a Lipo Ultra HD U-graft, aquela em a gordura localizada eÃÅ retirada, tratada e saÃÉo feitos enxertos de gordura rica em ceÃÅlulas tronco dentro dos muÃÅsculos, guiados por ultrassom, para causar real hipertrofia na musculatur.\n\n‚Ä¢ Mommy Makeover: \nhttps://drive.google.com/file/d/1rHDDoy0FnGHeMVj85SaHjMixAsMzN9Df/view?usp=drive_link\n\n‚Ä¢ Nariz: \nhttps://drive.google.com/file/d/18lClDoNOdZD8NkSqZvD3LX07rwjpsQDT/view?usp=drive_link\nRinoplastia √© uma cirurgia do nariz que utiliza um aparelho de ultrassom, que vibra em alta frequ√™ncia e corta o osso sem danificar as estruturas ao redor, como cartilagens, veias, nervos e art√©rias.\n-A Rinoplastia Ultrass√¥nica √© considerada menos invasiva e traum√°tica do que a rinoplastia tradicional, resultando em um p√≥s operat√≥rio mais confort√°vel para o paciente.\n-√Äs vezes √© necess√°rio estruturar o nariz usando a cartilagem retirada de outra parte do corpo do paciente. Al√©m disso, a Dra. Stella precisa examinar tamb√©m se o paciente tem algum problema funcional, como desvio de septo por exemplo, para corrigir na hora da cirurgia. Tudo isso vai influenciar na complexidade de cada caso e no valor da cirurgia tamb√©m. \n\n‚Ä¢ Ninfoplastia:\n https://drive.google.com/file/d/1_YqJbza-hujH-fKUSuVE3dLJs4N76wNR/view?usp=drive_link\n√â a cirurgia √≠ntima que visa reduzir  os pequenos l√°bios da vagina. Muitas mulheres recorrem a esse tipo de cirurgia por apresentarem alguma esp√©cie de hipertrofia nessa zona do corpo e desejarem corrigi-la.\n-√â uma cirurgia bem r√°pida e que tem uma recupera√ß√£o no p√≥s-cir√∫rgico  bem tranquila. Essa cirurgia muitas vezes proporciona uma melhoria incr√≠vel na qualidade de vida da paciente.\n‚Ä¢ Orelha: \nhttps://drive.google.com/file/d/1-89_aletIXFc0ZvGt801UlPgVc_hCmkm/view?usp=drive_link\nA cirurgia da orelha √© indicada para quem deseja harmonizar os tra√ßos faciais e para melhorar a autoestima de adultos e crian√ßas com orelhas excessivamente grandes, deformadas ou projetadas (orelha de abano). Al√©m de corrigir o abano pode tamb√©m refazer as curvas e os contornos de uma orelha normal.\n-√â uma cirurgia que normalmente √© realizada sob anestesia local e seda√ß√£o e que pode ser feita em crian√ßas a partir de 6 anos de idade.\n\n‚Ä¢ Mama: \nhttps://drive.google.com/file/d/1DKxKdEDL48FYwu7CCwMlkd8V8QU3oBei/view?usp=drive_link\nA mamoplastia de aumento, tamb√©m chamada de cirurgia de aumento das mamas ou de pr√≥tese de silicone, √© um dos procedimentos mais realizados no pa√≠s. A cirurgia utiliza implantes que d√£o volume aos seios ou restauram o volume natural que pode ter sido perdido ap√≥s perda de peso ou gesta√ß√£o.\n-A cirurgia de pr√≥tese de silicone n√£o √© igual para todas as mulheres. Para conquistar um aspecto natural, devem ser levadas em considera√ß√£o as caracter√≠sticas f√≠sicas individuais e expectativas em rela√ß√£o ao resultado.\n-A escolha da pr√≥tese de silicone ideal √© feita em conjunto: m√©dica e paciente, pois fatores como altura, qualidade da pele, largura do t√≥rax e estilo de vida s√£o preponderantes na escolha do tamanho e formato do silicone. \nA Mastopexia √© a cirurgia que levanta e remodela a mama atrav√©s da retirada de pele excedente e do reposicionamento das ar√©olas e do tecido mam√°rio. Pode ser realizado com ou sem o implante de pr√≥teses de silicone. \nA cirurgia de mastopexia n√£o √© igual para todas as mulheres. Para conquistar um aspecto natural, devem ser levadas em considera√ß√£o as caracter√≠sticas f√≠sicas individuais e expectativas em rela√ß√£o ao resultado. A cicatriz pode ser em L ou em T invertido.\n-A escolha ou n√£o do uso de pr√≥teses de silicone  √© feita em conjunto entre m√©dica e paciente, pois fatores como idade, altura, peso, qualidade da pele, tamanho da mama, largura do t√≥rax e estilo de vida s√£o preponderantes nessa escolha.\n\n‚Ä¢\tBlefaroplastia:\nA blefaroplastia √© uma cirurgia bem r√°pida e que traz um benef√≠cio enorme para o paciente. Pode ser feita nas p√°lpebras superiores e/ou inferiores, retirando o excesso de pele e bolsinhas de gordura. √â uma cirurgia que tem uma recupera√ß√£o r√°pida.\nAl√©m do envelhecimento, ainda podem ser corrigidas ou minimizadas altera√ß√µes heredit√°rias atrav√©s da blefaroplastia, que torna o olhar mais descansado, fresco e alerta, colocando fim ao semblante triste, cansado ou envelhecido.\n\n‚Ä¢\tLifiting de Face\n√â um dos procedimentos mais procurados atualmente na cirurgia pl√°stica porque tem a finalidade  de melhorar os sinais decorrentes do envelhecimento no rosto e no pesco√ßo. Essa cirurgia proporciona um resultado natural, diminuindo a flacidez da pele e levantando as estruturas mais profundas da face, tratando tamb√©m a papada.\n\n‚Ä¢\tRemodela√ß√£o costal\nA cirurgia de remodela√ß√£o costal √© usada para diminuir a cintura em m√©dia de 7 a 12 cm. √â uma cirurgia minimamente invasiva, onde atrav√©s de uma incis√£o do tamanho do furo de agulha e usando um ultrassom de √∫ltima gera√ß√£o √© feito o enfraquecimento das 3 √∫ltimas costelas. No p√≥s cir√∫rgico a paciente far√° o uso do corset, que √© o respons√°vel por fazer a mudan√ßa de angula√ß√£o das costelas entre 60 a 90 dias.\n√â uma cirurgia que normalmente √© realizada sob anestesia geral e que pode ser feita combinada com a lipoaspira√ß√£o ou abdominoplastia.\n\nEnvie os links quando achar necess√°rio. N√£o precisa perguntar se o paciente quer que voc√™ envie. Simplesmente envie o link e informe o que tem nele.\n<tipos de cirurgia>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -416,
        96
      ],
      "id": "759dd7bc-79d8-4ccf-a4ab-66a334b96b11",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -464,
        288
      ],
      "id": "9fdcd7c7-9f21-4ba1-83a0-4c0998a364b6",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -976,
        96
      ],
      "id": "269756b7-413d-4367-8a20-74212c715452",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Filtra os dados').item.json.cliente.Numero }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -336,
        464
      ],
      "id": "a39825e3-f052-4e4f-854d-200cc98e4095",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "lyEBuvIcd6Sn4Qaf",
          "name": "postg_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ 'stellaamorim:queue:' + $('Filtra os dados').item.json.cliente.Numero }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -672,
        320
      ],
      "id": "a1ace5c2-afbc-4616-8662-923a436565ea",
      "name": "limpa a fila1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ 'stellaamorim:queue:' + $('Filtra os dados').item.json.cliente.Numero }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1264,
        96
      ],
      "id": "1d03c644-ce88-4b9f-add3-3dbb938a8c70",
      "name": "limpando os testes de fluxo1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agente de IA Amora\n",
        "height": 768,
        "width": 336,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -480,
        16
      ],
      "id": "fb9d0f3f-821b-4055-b8d0-874254818a1d",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3200bdfe-5881-43e0-9991-921c18a96289",
              "name": "Resposta",
              "value": "={{ $json.output.split('\\n\\n') }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -16,
        96
      ],
      "id": "4013276f-216b-4522-8f8d-33475fae6bfc",
      "name": "SeparandoMensagemEmPartes1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "Resposta",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        32,
        368
      ],
      "id": "23f68bb7-01b9-4a20-84df-8b8505e5657e",
      "name": "Split Out1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        736,
        416
      ],
      "id": "c211bd22-b7ea-4029-bc8b-85bfd8af3788"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/stellaamorim",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "4A76B0D99D00-4807-A1DC-DD8AAB2CCFE8"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": {{ JSON.stringify($('Filtra os dados').item.json.cliente.Numero) }},\n  \"text\": {{ JSON.stringify($json.Resposta) }}\n}\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        336,
        304
      ],
      "id": "af06d352-c74f-48ab-8956-b76ae7ecb296",
      "name": "EnviarespostaAoCliente1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0bb00fe7-fd10-4039-b3c8-4fa55e3e0e0f",
              "name": "Resposta",
              "value": "={{ $('Split Out1').item.json.Resposta.replaceAll('\"','').replace(/\\\\n/g,'\\n').replace(/\\n{2,}/g,'\\n\\n').replaceAll('\\\\\\\\','\\\\').replaceAll('#','\\\\#').replace(/[\\u0000-\\u001F\\u007F]/g,'').trim() }}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        512,
        64
      ],
      "id": "3e028703-faa4-4845-adbb-314079886966",
      "name": "LimpaMensagem1"
    },
    {
      "parameters": {
        "content": "## Separa, prepara e envia as mensagens uma por uma",
        "height": 832,
        "width": 1200,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -128,
        -48
      ],
      "id": "21df31f2-77f8-4afc-8f91-c9be2c29c4f4",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        288,
        48
      ],
      "id": "7f259036-b1b1-48d1-a9e1-ac34310299dd",
      "name": "envia uma mensagem por vez1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a01d0b8b-3c4e-4d0f-bc7e-0b6b8e2a7f11",
              "leftValue": "={{ $json.message_count }}",
              "rightValue": 15,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        704,
        176
      ],
      "id": "6db3b221-8d39-45a6-aaf4-0ba87b0823de",
      "name": "ChecaLimiteMensagens1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.messages\nSET status = 'human', escalated_at = NOW()\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ $('contador_de_mensagens').item.json.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        896,
        160
      ],
      "id": "3172b9e0-a2f1-4efc-ac57-4262c48258b2",
      "name": "EscalaParaHumano1",
      "credentials": {
        "postgres": {
          "id": "lyEBuvIcd6Sn4Qaf",
          "name": "postg_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "messages",
          "mode": "list",
          "cachedResultName": "messages"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "message": 1,
            "phone": "={{ $('Filtra os dados').item.json.cliente.Numero }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3200,
        240
      ],
      "id": "b36ba2b8-faa9-42b5-804f-d74e057562f0",
      "name": "cadastra o cliente1",
      "credentials": {
        "postgres": {
          "id": "lyEBuvIcd6Sn4Qaf",
          "name": "postg_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "messages",
          "mode": "list",
          "cachedResultName": "messages"
        },
        "where": {
          "values": [
            {
              "column": "phone",
              "value": "={{ $json.cliente.Numero }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3568,
        480
      ],
      "id": "aadb5d5c-46dd-413f-9099-ff8bbf0da368",
      "name": "Pega os dados do Cliente1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "lyEBuvIcd6Sn4Qaf",
          "name": "postg_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "30681789-55d3-4fb4-aea3-f7981c8e99f9",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3408,
        384
      ],
      "id": "399930e7-a15a-4e7f-8b4a-719e2f816462",
      "name": "checarCliente1"
    },
    {
      "parameters": {
        "sendTo": "drastellaamorimadm@gmail.com",
        "subject": "Erro na Automa√ß√£o Stella Amorim, favor verificar\n",
        "emailType": "text",
        "message": "Erro na Automa√ß√£o Stella Amorim, favor verificar",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -4560,
        896
      ],
      "id": "361b2fff-417f-410b-9b05-00da0f398270",
      "name": "Send a message1",
      "webhookId": "e346146c-28e4-4c0a-836d-f943f37d94ef",
      "credentials": {
        "gmailOAuth2": {
          "id": "MU2Yc4592bNkP7hF",
          "name": "gmail"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0b2a9494-d578-4f42-b635-8cd2395bebbd",
              "leftValue": "={{ $('Recebe mensagem1').item.json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4112,
        240
      ],
      "id": "c0819104-ff24-4186-bb62-255ed168f5c9",
      "name": "FromMe?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "41e03a63-2506-4dee-9954-b9365b44b345",
              "name": "bot name",
              "value": "Amora",
              "type": "string"
            },
            {
              "id": "a3d1b8c2-7f2e-4a91-9411-4f1e3a9c0b21",
              "name": "block_ttl_seconds",
              "value": 300,
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4336,
        304
      ],
      "id": "eb66745b-329c-4fd3-9c52-7fa10b180015",
      "name": "configura√ß√£o Global1"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "isBlocked",
        "key": "={{ $('configura√ß√£o Global1').item.json['bot name'] }}_{{ $('Filtra os dados').item.json.cliente.Numero }}_block",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -4048,
        592
      ],
      "id": "e0d89867-a57c-4467-9e00-6c2c57d0eb70",
      "name": "bloqueado?1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ $('configura√ß√£o Global1').item.json['bot name'] }}_{{ $('Filtra os dados').item.json.cliente.Numero }}_block",
        "value": "true",
        "expire": true,
        "ttl": "={{ $('configura√ß√£o Global1').item.json['block_ttl_seconds'] || 300 }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3760,
        48
      ],
      "id": "4266a924-008c-4377-9441-fe132a4f690f",
      "name": "chave_bloqueio1",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1440,
        464
      ],
      "id": "159161dc-e38f-4634-8983-d83fd8249508",
      "name": "Espera4Segundos1",
      "webhookId": "25984ca0-664b-42e8-9ff1-80403eeb4c78"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e460b78c-6257-4b6a-808c-f1c963d90c98",
              "leftValue": "={{ $json.isBlocked }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "a5b0c3e1-3f9b-4d6f-9e2a-0b1c2d3e4f5a",
              "leftValue": "={{ $('Recebe mensagem1').item.json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3792,
        464
      ],
      "id": "f4a5ffd3-e973-4930-be1b-f611b5c84b71",
      "name": "bloqueioExiste?1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -3792,
        640
      ],
      "id": "04c12ba5-7381-4225-bc55-ec50b546aa44",
      "name": "IgnoraMensagem1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -4352,
        896
      ],
      "id": "b7743eff-a39b-4731-9897-952485671467",
      "name": "NaoFazNada1"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        512,
        304
      ],
      "id": "3531c38c-1301-42d5-a751-797c94f74c02",
      "name": "Espera 1 segundo1",
      "webhookId": "7e64b6e7-9da1-4485-8747-107721861246"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        -4752,
        896
      ],
      "id": "69f09244-5bd0-4618-b0a2-4f454bcbe2c3",
      "name": "Error Trigger"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.messages\nSET message = COALESCE(message, 0) + 1\nWHERE id = $1\nRETURNING id, message AS message_count;",
        "options": {
          "queryReplacement": "={{ $('Pega os dados do Cliente1').item.json.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3216,
        448
      ],
      "id": "0245cadc-6881-4973-9f2c-e60bb397c130",
      "name": "contador_de_mensagens",
      "credentials": {
        "postgres": {
          "id": "lyEBuvIcd6Sn4Qaf",
          "name": "postg_stellaamorim"
        }
      }
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "image/jpeg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2352,
        432
      ],
      "id": "e06eef97-ccb1-48f8-b2e5-debadda6f318",
      "name": "Converte o base64 em imagem"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "audio/ogg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2352,
        112
      ],
      "id": "a4efac9d-dcdb-4e0f-93fd-62851148df37",
      "name": "Converte o base64 em audio"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b739c470-bcfe-4d75-894b-792bf459b7f1",
              "name": "cliente.Nome",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "13d7132f-8e39-4bbf-9090-395d7f8cc421",
              "name": "cliente.Numero",
              "value": "={{ $json.body.data.key.senderPn || $json.body.data.key.remoteJid  }}",
              "type": "string"
            },
            {
              "id": "801441ac-40c7-4692-b74c-96a113e8b06e",
              "name": "cliente.UltimaMensagem",
              "value": "={{ $json.body.data.key.fromMe }}",
              "type": "boolean"
            },
            {
              "id": "7d300ead-226b-4e42-8d7a-c706861edcd6",
              "name": "wpp.TipoDeMensagem",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "bc9c971d-43dd-463a-99d8-8d8b19cf9dfe",
              "name": "cliente.Data",
              "value": "={{ $json.body.date_time.toDateTime().format('dd/MM/yyyy') }}",
              "type": "string"
            },
            {
              "id": "842be4a9-c5f6-46d5-8f50-7de1279e749a",
              "name": "wpp.Mensagem",
              "value": "={{ $json.body.data.message.audioMessage?.base64 || $json.body.data.message?.base64  || $json.body.data.message.conversation || null }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4560,
        304
      ],
      "id": "0bedc407-1205-4b94-874d-ca9a85fb779d",
      "name": "Filtra os dados"
    }
  ],
  "pinData": {
    "Recebe mensagem1": [
      {
        "json": {
          "headers": {
            "host": "quickaiautomation.app.n8n.cloud",
            "user-agent": "axios/1.12.2",
            "content-length": "1368",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "5.161.206.196",
            "cf-ew-via": "15",
            "cf-ipcountry": "US",
            "cf-ray": "9a029d88b132d6e9-IAD",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "x-forwarded-for": "5.161.206.196, 172.71.194.230",
            "x-forwarded-host": "quickaiautomation.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-49-5f8b879977-tf6vm",
            "x-is-trusted": "yes",
            "x-real-ip": "5.161.206.196"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "stellaamorim",
            "data": {
              "key": {
                "remoteJid": "554491813693@s.whatsapp.net",
                "remoteJidAlt": "554491813693@s.whatsapp.net",
                "fromMe": false,
                "id": "3A67690647E066B84709"
              },
              "pushName": "Tiago ",
              "status": "DELIVERY_ACK",
              "message": {
                "conversation": "Teste",
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyIndexes": [],
                    "recipientKeyIndexes": [],
                    "senderKeyHash": {
                      "0": 63,
                      "1": 214,
                      "2": 245,
                      "3": 117,
                      "4": 249,
                      "5": 30,
                      "6": 76,
                      "7": 114,
                      "8": 250,
                      "9": 184
                    },
                    "senderTimestamp": 1763159804,
                    "recipientKeyHash": {
                      "0": 69,
                      "1": 72,
                      "2": 245,
                      "3": 84,
                      "4": 118,
                      "5": 47,
                      "6": 165,
                      "7": 165,
                      "8": 244,
                      "9": 195
                    },
                    "recipientTimestamp": 1762340258
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": {
                    "0": 89,
                    "1": 246,
                    "2": 116,
                    "3": 45,
                    "4": 228,
                    "5": 19,
                    "6": 103,
                    "7": 241,
                    "8": 29,
                    "9": 156,
                    "10": 92,
                    "11": 2,
                    "12": 198,
                    "13": 32,
                    "14": 116,
                    "15": 135,
                    "16": 247,
                    "17": 163,
                    "18": 172,
                    "19": 52,
                    "20": 221,
                    "21": 39,
                    "22": 183,
                    "23": 104,
                    "24": 150,
                    "25": 228,
                    "26": 36,
                    "27": 159,
                    "28": 47,
                    "29": 42,
                    "30": 62,
                    "31": 11
                  }
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1763418026,
              "instanceId": "15d31f84-99ba-4534-b597-2ca01fc63441",
              "source": "ios"
            },
            "destination": "https://quickaiautomation.app.n8n.cloud/webhook-test/4401d2fb-0746-45e6-8a45-0b83d5b4a20b",
            "date_time": "2025-11-17T19:20:26.314Z",
            "sender": "5521997804980@s.whatsapp.net",
            "server_url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host",
            "apikey": "4A76B0D99D00-4807-A1DC-DD8AAB2CCFE8"
          },
          "webhookUrl": "https://quickaiautomation.app.n8n.cloud/webhook-test/4401d2fb-0746-45e6-8a45-0b83d5b4a20b",
          "executionMode": "test"
        }
      }
    ]
  },
  "connections": {
    "ComandoDesbloquear?": {
      "main": [
        [
          {
            "node": "RemoverChaveBloqueio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "bloqueado?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recebe mensagem1": {
      "main": [
        [
          {
            "node": "Filtra os dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega base64 imagem1": {
      "main": [
        [
          {
            "node": "Converte o base64 em imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega base64 audio1": {
      "main": [
        [
          {
            "node": "Converte o base64 em audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unifica os dados1": {
      "main": [
        [
          {
            "node": "RegistraMensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisa Imagem1": {
      "main": [
        [
          {
            "node": "Unifica os dados1",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Transcreve audio1": {
      "main": [
        [
          {
            "node": "Unifica os dados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipagem de mensagem1": {
      "main": [
        [
          {
            "node": "Pega base64 audio1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MensagemTexto1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pega base64 imagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuscaMensagem1": {
      "main": [
        [
          {
            "node": "verificaSeTemMaisMensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RegistraMensagem1": {
      "main": [
        [
          {
            "node": "BuscaMensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificaSeTemMaisMensagens1": {
      "main": [
        [
          {
            "node": "limpando os testes de fluxo1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Espera4Segundos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VerificaMensagem1": {
      "main": [
        [
          {
            "node": "OrganizaMensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OrganizaMensagem1": {
      "main": [
        [
          {
            "node": "limpa a fila1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MensagemTexto1": {
      "main": [
        [
          {
            "node": "Unifica os dados1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "SeparandoMensagemEmPartes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "limpa a fila1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "limpando os testes de fluxo1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SeparandoMensagemEmPartes1": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "envia uma mensagem por vez1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me1": {
      "main": [
        [
          {
            "node": "envia uma mensagem por vez1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviarespostaAoCliente1": {
      "main": [
        [
          {
            "node": "Espera 1 segundo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LimpaMensagem1": {
      "main": [
        [
          {
            "node": "EnviarespostaAoCliente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia uma mensagem por vez1": {
      "main": [
        [],
        [
          {
            "node": "LimpaMensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ChecaLimiteMensagens1": {
      "main": [
        [
          {
            "node": "EscalaParaHumano1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EscalaParaHumano1": {
      "main": [
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cadastra o cliente1": {
      "main": [
        [
          {
            "node": "Tipagem de mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega os dados do Cliente1": {
      "main": [
        [
          {
            "node": "checarCliente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "checarCliente1": {
      "main": [
        [
          {
            "node": "cadastra o cliente1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "contador_de_mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message1": {
      "main": [
        [
          {
            "node": "NaoFazNada1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FromMe?": {
      "main": [
        [
          {
            "node": "chave_bloqueio1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ComandoDesbloquear?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "configura√ß√£o Global1": {
      "main": [
        [
          {
            "node": "FromMe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloqueado?1": {
      "main": [
        [
          {
            "node": "bloqueioExiste?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espera4Segundos1": {
      "main": [
        [
          {
            "node": "VerificaMensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloqueioExiste?1": {
      "main": [
        [
          {
            "node": "IgnoraMensagem1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pega os dados do Cliente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espera 1 segundo1": {
      "main": [
        [
          {
            "node": "ChecaLimiteMensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "contador_de_mensagens": {
      "main": [
        [
          {
            "node": "Tipagem de mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converte o base64 em imagem": {
      "main": [
        [
          {
            "node": "Analisa Imagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converte o base64 em audio": {
      "main": [
        [
          {
            "node": "Transcreve audio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtra os dados": {
      "main": [
        [
          {
            "node": "configura√ß√£o Global1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "3izS12nA01KCzCRO"
  },
  "versionId": "6393b68e-b8c7-4ff8-9b38-c40e8590d163",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9c92701cdb48281154ad624eeeca4a6739a2b2ed112fc4a143ad41555270a5c0"
  },
  "id": "3izS12nA01KCzCRO",
  "tags": [
    {
      "updatedAt": "2025-11-17T22:36:46.610Z",
      "createdAt": "2025-11-17T22:36:46.610Z",
      "id": "JSSRe4aPyYkJEb3z",
      "name": "clinical_agent"
    }
  ]
}